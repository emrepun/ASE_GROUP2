sudo: required

before_cache:
        - rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
        - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
        directories:
                - $HOME/.gradle/caches/
                - $HOME/.gradle/wrapper/

env:
        global:
                - ANDROID_API=25
                - EMULATOR_API=25
                - ANDROID_BUILD_TOOLS=24.0.2
                - ANDROID_ABI=armeabi-v7a
                - ANDROID_TAG=google_apis
                - ADB_INSTALL_TIMEOUT=5


matrix:
        include:
                - language: node_js
                  node_js:
                        - "7"
                  before_script:
                        - cd ASE_backend
                  script:
                        - npm install
                        - npm test


                - language: android
                  jdk: oraclejdk8
                  android:
                          components:
                                  - tools
                                  - platform-tools
                                  - build-tools-$ANDROID_BUILD_TOOLS
                                  - android-$ANDROID_API
                                  - android-$EMULATOR_API_LEVEL
                                  - extra-google-m2repository
                                  - extra-android-m2repository # for design library
                                  - addon-google_apis-google-19 # google play services
                                  - sys-img-armeabi-v7a-addon-google_apis-google-$ANDROID_API_LEVEL
                                  - sys-img-armeabi-v7a-android-$EMULATOR_API_LEVEL
                          licenses:
                                  - android-sdk-preview-license-.+
                                  - android-sdk-license-.+
                                  - google-gdk-license-.+
                  before_install:
                          - mkdir "$ANDROID_HOME/licenses" || true
                          - echo -e "\n8933bad161af4178b1185d1a37fbf41ea5269c55" > "$ANDROID_HOME/licenses/android-sdk-license"
                          - echo -e "\n84831b9409646a918e30573bab4c9c91346d8abd" > "$ANDROID_HOME/licenses/android-sdk-preview-license"
                          - cd ASE_android
                          - chmod +x ./gradlew
                          - echo y | android update sdk --no-ui --all --filter "tool,extra-android-m2repository,extra-android-support,extra-google-google_play_services,extra-google-m2repository"
                          - echo y | $ANDROID_HOME/tools/bin/sdkmanager "extras;m2repository;com;android;support;constraint;constraint-layout-solver;1.0.2"
                  before_script:
                          - echo "y" | android update sdk -a --no-ui --filter android-24
                          - echo "y" | android update sdk -a --no-ui --filter sys-img-armeabi-v7a-android-24
                          - android list targets | grep -E '^id:' | awk -F '"' '{$1=""; print $2}'
                          - echo no | android create avd --force -n test -t android-24 --abi armeabi-v7a
                          - sudo cp -R /root/.android $HOME
                          - emulator -avd test -no-skin -no-window &
                          - android-wait-for-emulator
                          - adb shell input keyevent 82 &
                  script:
                          - ./gradlew clean build connectedCheck --stacktrace
                  
                - language: objective-c
                  os: osx
                  osx_image: xcode9.4
                  xcode_project: ASE_iOS.xcodeproj
                  xcode_scheme: ASE_iOS
                  xcode_destination: platform=iOS Simulator,OS=10.3,name=iPhone XS Max
                  before_script:
                          - cd ASE_iOS
                          - pod repo update
                          - pod install
                  script:
                          - xcodebuild clean test -project ASE_iOS.xcodeproj -scheme ASE_iOS -destination "platform=iOS Simulator,OS=10.1,name=iPhone 7" CODE_SIGN_IDENTITY="" CODE_SIGNING_REQUIRED=NO ONLY_ACTIVE_ARCH=NO -quiet

